@page "/books/{id:int}"
@inject BookDetailsPageManager PageManager
@inject NavigationManager Navigation
@inject IJSRuntime JS

<div class="book-details-container">
    @if (PageManager.CurrentBook == null)
    {
        <div class="loading-state">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Se Ã®ncarcÄƒ...</span>
            </div>
            <p class="mt-3">Se Ã®ncarcÄƒ detaliile cÄƒrÈ›ii...</p>
        </div>
    }
    else
    {
        <div class="book-details-card">
            <!-- Back Button -->
            <div class="mb-4">
                <button class="btn btn-outline-secondary" @onclick="PageManager.NavigateToBooks">
                    â† Ãnapoi la cÄƒrÈ›i
                </button>
            </div>

            <!-- Book Header -->
            <div class="book-header">
                <div class="book-header-content">
                    <div class="book-icon">ğŸ“–</div>
                    <div class="book-header-info">
                        <h1 class="book-details-title">@PageManager.CurrentBook.Title</h1>
                        <div class="book-meta">
                            <span class="meta-item">
                                <strong>ğŸ“… Anul publicÄƒrii:</strong> @PageManager.CurrentBook.Year
                            </span>
                            <span class="meta-item">
                                <strong>ğŸ“† AdÄƒugatÄƒ la:</strong> @PageManager.CurrentBook.CreatedAt.ToString("dd MMMM yyyy, HH:mm")
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Book Content Grid -->
            <div class="book-content-grid">
                <!-- Author Section -->
                <div class="detail-section">
                    <div class="section-icon">âœï¸</div>
                    <div class="section-content">
                        <h3 class="section-title">Autor</h3>
                        @if (PageManager.CurrentBook.Author != null)
                        {
                            <div class="author-card">
                                <h4 class="author-name">@PageManager.CurrentBook.Author.Name</h4>
                                @if (!string.IsNullOrEmpty(PageManager.CurrentBook.Author.Email))
                                {
                                    <p class="author-email">
                                        <span class="email-icon">âœ‰ï¸</span> @PageManager.CurrentBook.Author.Email
                                    </p>
                                }
                                @if (!string.IsNullOrEmpty(PageManager.CurrentBook.Author.Biography))
                                {
                                    <div class="author-bio">
                                        <strong>Biografie:</strong>
                                        <p>@PageManager.CurrentBook.Author.Biography</p>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p class="text-muted">Autor necunoscut</p>
                        }
                    </div>
                </div>

                <!-- Categories Section -->
                <div class="detail-section">
                    <div class="section-icon">ğŸ·ï¸</div>
                    <div class="section-content">
                        <h3 class="section-title">Categorii</h3>
                        @if (PageManager.CurrentBook.BookCategories?.Any() == true)
                        {
                            <div class="categories-list">
                                @foreach (var bookCategory in PageManager.CurrentBook.BookCategories)
                                {
                                    <div class="category-item">
                                        <div class="category-header">
                                            <span class="category-name">@(bookCategory.Category?.Name ?? "N/A")</span>
                                        </div>
                                        @if (!string.IsNullOrEmpty(bookCategory.Category?.Description))
                                        {
                                            <p class="category-description">@bookCategory.Category.Description</p>
                                        }
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p class="text-muted">Nicio categorie atribuitÄƒ</p>
                        }
                    </div>
                </div>
            </div>

            <!-- Book Statistics -->
            <div class="book-statistics">
                <div class="stat-item">
                    <div class="stat-icon">ğŸ·ï¸</div>
                    <div class="stat-value">@(PageManager.CurrentBook.BookCategories?.Count ?? 0)</div>
                    <div class="stat-label">Categorii</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">ğŸ“…</div>
                    <div class="stat-value">@PageManager.CurrentBook.Year</div>
                    <div class="stat-label">An publicare</div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">â±ï¸</div>
                    <div class="stat-value">@PageManager.GetDaysAgo()</div>
                    <div class="stat-label">AdÄƒugatÄƒ acum</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="book-actions">
                <button class="btn btn-primary btn-lg" @onclick="() => PageManager.NavigateToEdit(Id)">
                    âœï¸ EditeazÄƒ Cartea
                </button>
                <button class="btn btn-outline-danger btn-lg" @onclick="DeleteBook">
                    ğŸ—‘ï¸ È˜terge Cartea
                </button>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await PageManager.LoadBookAsync(Id);
    }

    private async Task DeleteBook()
    {
        bool confirmed = await JS.InvokeAsync<bool>("confirm", $"EÈ™ti sigur cÄƒ vrei sÄƒ È™tergi cartea '{PageManager.CurrentBook?.Title}'?");
        if (confirmed)
        {
            await PageManager.DeleteBookAsync(Id);
        }
    }
}